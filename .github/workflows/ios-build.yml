name: iOS Build (Debug)

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ios-build:
    runs-on: macos-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'yarn'
        cache-dependency-path: mobile/yarn.lock
        
    - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
      working-directory: mobile
      run: yarn install --frozen-lockfile
        
    - name: âš™ï¸ í™˜ê²½ ì„¤ì •
      working-directory: mobile
      run: |
        echo "APP_ENV=staging" > .env
        echo "API_BASE_URL=https://api.example.com" >> .env
        echo "TIMEOUT=15000" >> .env
        echo "DEBUG_MODE=true" >> .env
        echo "ğŸ“„ í™˜ê²½ íŒŒì¼ ë‚´ìš©:"
        cat .env
        
    - name: ğŸ CocoaPods ì„¤ì¹˜
      working-directory: mobile
      run: npx pod-install ios
        
    - name: ğŸ—ï¸ iOS ë¹Œë“œ (ë””ë²„ê·¸ ëª¨ë“œ)
      working-directory: mobile
      run: |
        echo "ğŸ” Xcode ë²„ì „ í™•ì¸:"
        xcodebuild -version
        
        echo "ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸:"
        ls -la ios/
        
        echo "ğŸ—ï¸ iOS ë¹Œë“œ ì‹œì‘ (Debug ëª¨ë“œ):"
        xcodebuild -workspace ios/mobile.xcworkspace \
          -scheme mobile \
          -configuration Debug \
          -sdk iphonesimulator \
          -derivedDataPath ios/build \
          build
          
    - name: ğŸ“¦ ë¹Œë“œ ê²°ê³¼ í™•ì¸
      working-directory: mobile
      run: |
        echo "ğŸ“‚ ë¹Œë“œ ê²°ê³¼ í™•ì¸:"
        find ios/build -name "*.app" -type d
        ls -la ios/build/Build/Products/Debug-iphonesimulator/ || true
        
        if [ -d "ios/build/Build/Products/Debug-iphonesimulator/mobile.app" ]; then
          echo "âœ… mobile.app ë°œê²¬!"
          ls -la ios/build/Build/Products/Debug-iphonesimulator/mobile.app/
        else
          echo "âŒ mobile.appì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
          echo "ğŸ“‚ ì „ì²´ ë¹Œë“œ ë””ë ‰í„°ë¦¬ êµ¬ì¡°:"
          find ios/build -type d -name "*.app" || true
        fi